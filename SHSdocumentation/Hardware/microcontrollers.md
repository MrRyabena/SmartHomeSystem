
# 5. Выбор компонентов

## 5.1 Микроконтроллеры

Для управления всеми модулями от микроконтроллеров требуется наличие достаточного количества выводов `GPIO`, поддержка (желательно аппаратная) интерфейсов `UART`, `I2C`, `SPI`, `PWM`, `WiFi`, и встроенный `ADC`.</br>

Сейчас на рынке представлено много линеек микроконтроллеров, доступных простым радиолюбителям:

- Компания `Atmel` представляет семейства на архитектуре AVR — `Attiny` и `Atmega`. Первые микроконтроллеры совсем крохотные и использовать их можно только для небольших задач, например, управления одним светильником и связи с остальными. Семейство Atmega более известно под маркой Arduino, т.к. лежит в основе большинства их плат. Эти камни уже могут похвастаться большим арсеналом GPIO, ADC, высоким выходным током с пина. На их основе можно собирать полноценные модули, не хватает только WiFi или другой беспроводной связи.

- Китайцы, в лице `Espressif Systems` разработали свою линейку микроконтроллеров с WiFi на борту, flash-памятью и достаточно мощными (для задач умного дома) вычислительными ядрами.

- В сети много гайдов по созданию сервера умного дома на основе `Raspberry Pi`. Это семейство представляет собой целые миниатюрные компьютеры на архитектуре ARM, позволяющие работать с операционной системой Linux и выводить изображение на монитор. Тема на самом деле достаточно крутая и найти им применение не составит проблем — можно собрать домашний сервер и это выйдет компактнее, чем переделывать какой-нибудь старый компьютер. </br>

  Мощности Малинки для Smart Home System будут избыточные, да и стоят такие платы достаточно дорого.</br>

В итоге выбор пал на 3 основных микроконтроллера: Atmega328P, ESP8266, ESP32.

### 5.1.1 ATmega328P

Микроконтроллер удобен в использовании, крайне неприхотлив в эксплуатации, имеет много аналоговых пинов, аппаратную поддержку ШИМ. WiFi на борту нет, поэтому его придется связывать с ESP по UART.</br>

В проекте используется “голый” микроконтроллер (особенно там, где нужна компактность), либо платы Arduino Nano, Arduino Pro Mini.

| Parametr                 | Value              |
| :----------------------- | :----------------- |
| CPU type                 | 8-bit AVR          |
| CPU speed                | 16 MHz             |
| Сurrent consumption      | <<100 mA           |
| Flash memory             | 32 KB              |
| SRAM                     | 2 KB               |
| EEPROM                   | 1 KB               |
| I/O pins                 | 23                 |
| Max current from the pin | 40 mA              |
| PWM pins                 | 6                  |
| ADC pins                 | 8 channels, 10-bit |
| DAC                      | none               |
| External interrupts      | 3                  |
| I2C                      | 1                  |
| I2S                      | none               |
| SPI                      | 1                  |
| UART                     | 1                  |
| WiFi                     | none               |
| Bluetooth                | none               |
| Operating Voltage Range  | 1.8 — 5.5 V        |

![ATmega328P pinout](../../schemes/Atmega328P-pinout.png)

### 5.1.2 ESP8266

Имеет WiFi, достаточно много оперативной и постоянной памяти – шустрый процессор. Хорошо подходит для взаимодействия с другими цифровыми устройствами и интернетом. Из минусов: слабый ток с пина (12 mA), рабочее напряжение 3.3 V, нет аппаратной поддержки PWM (реализована программно) и всего 1 канал АЦП.</br>

“Голый” микроконтроллер — ESP12F.</br>
Платы — NodeMCU или WemosD1 mini.</br>

| Parametr                 | Value                |
| :----------------------- | :------------------- |
| CPU type                 | Xtensa L106, 32 bit  |
| CPU speed                | 80/160 MHz           |
| Сurrent consumption      | 300 mA               |
| Flash memory             | 1-16 MB              |
| SRAM                     | 82 KB                |
| EEPROM                   | 4 KB                 |
| I/O pins                 | 11                   |
| Max current from the pin | 12 mA                |
| PWM pins                 | 10 (**software!**)   |
| ADC pins                 | 1                    |
| DAC                      | none                 |
| External interrupts      | 10                   |
| I2C                      | 1 (software)         |
| I2S                      | 1                    |
| SPI                      | 1                    |
| UART                     | 1.5                  |
| WiFi                     | 802.11 b/g/n 2,4 GHz |
| Bluetooth                | none                 |
| Operating Voltage Range  | 2.2—3.6V             |

![EPS8266 pinout](../../schemes/esp8266-pinout.jpg)

### 5.1.3 ESP32

Имеет двухъядерный процессор, большой объем памяти, WiFi, PWM, аппаратную поддержку цифровых протоколов, сенсорные пины, много каналов ADC, DAC и выход звукового сигнала. Мощный чип, на котором будет собран сервер. В проекте используется “голый” микроконтроллер, но также можно взять платы (аналогично ESP8266).

| Parametr                 | Value                         |
| :----------------------- | :---------------------------- |
| CPU type                 | Xtensa LX6, dual-core, 32 bit |
| CPU speed                | 160/240 MHz                   |
| Сurrent consumption      | 300 mA                        |
| Flash memory             | 1-16 MB                       |
| SRAM                     | 512 KB                        |
| EEPROM                   | 4 KB                          |
| I/O pins                 | 34                            |
| Max current from the pin | 12 mA                         |
| PWM pins                 | 16                            |
| ADC pins                 | 18, 12-bit                    |
| DAC                      | 2, 8-bit                      |
| External interrupts      | 34 (10 touch sensors)         |
| I2C                      | 2                             |
| I2S                      | 2                             |
| SPI                      | 4                             |
| UART                     | 3                             |
| WiFi                     | 802.11 b/g/n 2,4 GHz          |
| Bluetooth                | v4.2 BR/EDR and BLE           |
| Operating Voltage Range  | 2.2—3.6 V                     |

![ESP32 pinout](../../schemes/ESP32-VROOM-32D-PINOUT.png)
