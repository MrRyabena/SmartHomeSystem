
<a id="11_stageVI"></a>

# 11. Этап VI. Обучение системы саморегулированию

<a id="11-1_algorithmes"></a>

## 11.1 Алгоритмы поведения системы

<a id="11-1-1_autosystem"></a>

### 11.1.1 Автоматизация на основе датчиков

Система постоянно опрашивает датчики и получает с них информацию. На основе полученных данных система может сама контролировать процессы.</br>

Первым делом стоит автоматизировать все процессы, которые возможно. Свет может включаться по датчикам уровня освещенности, вентиляторы и вытяжки, когда зашкаливает датчик углекислого газа, ночью система не должна шуметь и издавать звуков.</br>

<a id="11-1-2_modes"></a>

### 11.1.2 Модели и режимы поведения

Далее следует разделить поведение системы на несколько моделей примерно так:

1. `Normal` — система работает в обычном режиме, все устройства функционируют без ограничений.

2. `StandBy` — система функционирует, продолжает опрашивать датчики и обрабатывать данные, но практически не включает никаких устройств.

3. `Silence` — система функционирует, но стремится ограничить все шумные процессы. Таким образом, обороты вентилятора будут максимально снижены, а реле, вытяжки, моторы и другие шумные приборы без крайней необходимости включаться не будут.

Разумеется, тремя режимами "умный" дом ограничиваться не должен, поэтому список можно продолжать, описывая различные ситуации и подстраивая под них систему.</br>

У структуры [`shs::Config`](src/SHScore/SHSconfig.h) есть поле `mode`, отвечающее за текущее состояние системы, однако таким образом можно устанавливать режим как для всей системы, так и для ее отдельных частей (подсистем, модулей или конкретных устройств (процессов)).

<a id="11-1-3_autoChoose"></a>

### 11.1.3 Автоматический выбор режима

Чтобы система использовала актуальный режим, надо построить логику выбора модели поведения, основываясь на времени. Переключение общих режимов (`Normal`, `StandBy`, `Silence`...) можно привязать ко времени суток. Отдельные приборы можно настроить по более точному графику, связав время и дни недели, таким образом, что чайник будет горячим по утрам в будни и ближе к обеду в выходные дни. Расписание работы шумных приборов можно назначить на время отсутствия пользователя дома.</br>

Правильно задав все параметры, можно добиться стабильной работы системы с оптимальным выбором режима.

<a id="11-2_neuralnet"></a>

## 11.2 SHSNeuralNet

**SHSNeuralNet** — разработка легкой нейронной сети для автоматического управления микросистемами и устройствами. За основу взята нейронная сеть из проекта [Winderton'a](https://github.com/Winderton/nerualnet).

<a id="11-2-1_neuralnet_originalStruct"></a>

### 11.2.1 Оригинальное устройство SHSNeuralNet

Сама нейронная сеть состоит из двух классов:

1. `neuron` — отдельный нейрон. Для активации выбрана функция гиперболического тангенса.
2. `net` — соединяет в себе нейроны.

Далее для взаимодействия с сетью автор предложил класс `trainingSet`, он может построить сеть по указанной топологии и обучить ее на представленных данных.

<a id="11-2-2_neuralnet_SHSstruct"></a>

### 11.2.2 Реализация в Smart Home System

Для использования в _**Smart Home System**_ класс `trainingSet` не подходит, поэтому на его основе будет создан другой.</br>

Вдобавок к существующим будет разработано еще несколько классов-инструментов для работы с нейронной сетью. Они будут сохранять ее в энергонезависимую память, разворачивать обратно, автоматически подбирать наилучшую топологию (структуру) сети, собирать информацию для обучения сети и проводить его в реальном времени. Эти инструменты позволят расширить функционал и заменять одну сеть на другую, просто вытащив ее из постоянной памяти.</br>

Классы будут оптимизированы и доработаны. Такая нейросеть будет спокойно запускаться и функционировать на ресурсах одного микроконтроллера, а смена одной нейронной сети на другую расширит возможности ее применения все еще на том же контроллере.</br>

Конечно, такая нейросеть достаточно примитивная и для сложного анализа большого объема данных она никак не подходит, однако это идеальный вариант в рамках умного дома.

<a id="11-2-3_manageSystem"></a>

### 11.2.3 Управление системой

**SHSNeuralNet** принимает на вход множество факторов, обрабатывает их и выдает результат на выходе. Таким образом, она может контролировать процессы, которые сложно или долго описывать вручную. Она может определять, когда надо начать будить пользователя, как долго его не будет дома, когда подогреть чайник к его приходу и в какой момент пора начинать подготовку ко сную. Все это происходит в режиме реального времени, основываясь на показаниях датчиков, времени нахождения пользователя в разных частях дома, его занятиях и предпочтениях, которые обусловлены временными, внешними и внутренними факторами.</br>

Обрабатывая большое количество факторов, нейросеть способна очень эффективно управлять системой и ее отдельными процессами, корректируясь (в рабочем режиме), что актуально, если, например, у пользователя наступил отпуск и сменилась его манера поведения.

<a id="11-2-4_prediction"></a>

### 11.2.4 Предсказание событий

**SHSNeuralNet** может взять в "голову" много факторов и находить среди них закономерности. Основываясь на них, нейросеть может попробовать предсказать событие. Такое применение очень актуально для некоторых устройств и процессов:

- Для предсказания изменения погоды людьми давно выведены закономерности, основанные на наблюдении за давлением, влажностью, температурой воздуха и прочими параметрами. Очень сложно запрограммировать и учитывать все факторы и законы одновременно. Поэтому встроенная в метеостанцию нейросеть после грамотного обучения будет способна очень точно предсказывать изменение погоды в ближайшие несколько часов. Кроме того, нейросеть сможет сформировать рекомендации по выбору одежды для выхода на улице.

- _**Smart Home System**_ предлагает огромное количество настроек системы. Разобраться с ними частично помогают графические интерфейсы. Чтобы пользователю было удобнее управлять системой, она должна предлагать небольшой интерфейс, который позволяет быстро и удобно скорректировать необходимые параметры. Для формирования такого интерфейса отлично подойдет **SHSNeuralNet**.Она обрабатывает время, прошлые предпочтения пользователя и его поведение, после чего формирует наиболее востребованный интерфейс на данный момент. Например, ближе к вечеру система предложит кнопку для плавного выключения света и подготовки ко сну, а утром наоборот — расположит кнопки для включения всех устройств и настройки расписания на день.

<a id="11-3_advancedNeuralNet"></a>

## 11.3 AdvancedNeuralNet

Идея заключается в распределении нейронной сети по всем модулям. Современные нейросети создаются на больших серверах и требуют огромных вычислительных ресурсов. _**Smart Home Syste**_ предлагает встраивать нейроны или мини-нейронные сети прямо в датчики и модули, а потом объединять их в единую сеть.</br>

Такая технология позволит снизить технические требования к главному серверу и сможет учитывать не только показания с датчиков, но и вес этих датчиков в системе, т.к., по сути, они будут являться отдельными нейронами.</br>

_Для более точного понимая возможностей такой сети необходимо подготовить базу, собрать много данных и провести серию экспериментов. Все это будет постепенно разрабатываться в следующих версиях проекта._

<a id="12_stageVII"></a>
